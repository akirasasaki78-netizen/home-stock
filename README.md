# おうちストック

夫婦で使える日用品・食料品管理アプリ（ローカル保存MVP）。

## 機能

- **買い物リスト** - 追加 / 削除 / チェック（購入済み）/ 並び替え
- **在庫リスト** - 追加 / 編集 / 削除 / 残量ステータス（十分・少ない・なし）
- **自動連携** - 購入済みにしたら在庫に自動追加。在庫が少ない/なしなら買い物リストへワンタップ追加
- **カテゴリ管理** - 初期4種＋自由追加
- **検索・フィルタ** - 品名検索、カテゴリ絞り込み、残量ステータス絞り込み
- **AirDrop共有** - JSONファイルとして全データを共有
- **オフライン対応** - PWAとしてホーム画面から起動可能

## セットアップ

### 方法1：ローカルサーバーで起動（推奨）

```bash
# Python 3がある場合
cd my-first-project
python -m http.server 8000

# Node.jsがある場合
npx serve .
```

ブラウザで `http://localhost:8000` を開く。

### 方法2：HTTPS環境にデプロイ

PWA（Service Worker）と Web Share API が完全に動作するにはHTTPS環境が必要です。
GitHub Pages、Netlify、Vercel などにデプロイしてください。

## iPhoneでホーム画面に追加する手順

1. **Safari** でアプリのURLを開く（Chrome等では不可）
2. 画面下の「共有」ボタン（四角＋矢印のアイコン）をタップ
3. 「ホーム画面に追加」をタップ
4. 名前を確認して「追加」をタップ

これでホーム画面からアプリとして起動でき、オフラインでも使えます。

## 共有（AirDrop）の使い方

### データを送る側

1. アプリ右上の **共有ボタン**（上矢印アイコン）をタップ
2. 「**共有する（AirDrop等）**」をタップ
3. iPhoneの共有シートが開くので「AirDrop」を選択
4. 相手のiPhoneを選んで送信

### データを受け取る側

1. AirDropで受け取ったJSONファイルを「ファイル」アプリなどに保存
2. アプリを開き、右上の **共有ボタン** をタップ
3. 「**JSONファイルを選択**」をタップ
4. 受け取ったファイルを選択
5. 確認画面で内容を確認し「**上書きインポート**」をタップ

### 運用ルール

- **買い物に行く前**に、最新のデータを共有しておく
- **買い物が終わったら**、更新した側がデータを共有し返す
- **同時に別々のアイテムを編集しない**（上書き方式のため後から送った方で上書きされる）
- 「最終更新」と「更新者」を見て、どちらが最新か確認する

## 共有がうまくいかない時

### Web Share APIが動かない

- **Safari** で開いてください（Chrome等では動作が異なる場合があります）
- **HTTPS** 環境が必要です（localhostは例外的にOK）
- フォールバック：「JSONをコピー」または「JSONファイルをダウンロード」ボタンを使用

### AirDropで送れない

1. 「JSONファイルをダウンロード」でファイルを保存
2. 「ファイル」アプリを開き、ダウンロードしたファイルを長押し
3. 「共有」→「AirDrop」で送信

### インポートでエラーが出る

- `.json` 拡張子のファイルか確認
- ファイルの中身がこのアプリで作成したデータか確認
- 必須項目（categories, shoppingItems, stockItems）が含まれている必要あり

## バックアップの復元

インポート実行時に自動バックアップが作成されます（最大10世代保持）。

### アプリ内で復元

1. 右上の **設定ボタン**（歯車アイコン）をタップ
2. 「**バックアップ復元**」セクションまでスクロール
3. 復元したい日時のバックアップを選択
4. 「**復元する**」をタップ

### 手動で復元（開発者向け）

Safari の Web Inspector やデバッグツールで：

```javascript
// バックアップ一覧を表示
for (let i = 0; i < localStorage.length; i++) {
  const key = localStorage.key(i);
  if (key.startsWith('home-stock-backup-')) console.log(key);
}

// 特定のバックアップを復元
const backup = localStorage.getItem('home-stock-backup-XXXXXXXXX');
localStorage.setItem('home-stock-data', backup);
location.reload();
```

## 技術仕様

- HTML / CSS / JavaScript（フレームワークなし）
- データ保存：LocalStorage
- PWA：manifest.json + Service Worker
- 共有：Web Share API + フォールバック（クリップボード / ダウンロード）

## データ構造

```json
{
  "version": 1,
  "updatedAt": "2025-01-01T00:00:00.000Z",
  "updatedBy": "夫",
  "categories": ["食料品", "日用品", "消耗品", "その他"],
  "shoppingItems": [
    {
      "id": "abc123",
      "name": "牛乳",
      "category": "食料品",
      "checked": false,
      "createdAt": "2025-01-01T00:00:00.000Z",
      "updatedAt": "2025-01-01T00:00:00.000Z"
    }
  ],
  "stockItems": [
    {
      "id": "def456",
      "name": "トイレットペーパー",
      "category": "消耗品",
      "status": "少ない",
      "note": "12ロール入り",
      "updatedAt": "2025-01-01T00:00:00.000Z"
    }
  ]
}
```

## 手動テストチェックリスト

1. [ ] **買い物リスト：追加** - ＋ボタンで品名・カテゴリを入力し追加される
2. [ ] **買い物リスト：チェック** - アイテムをチェックすると打ち消し線がつく
3. [ ] **買い物リスト：自動連携** - チェックしたアイテムが在庫リストに自動追加される（ステータス「十分」）
4. [ ] **買い物リスト：削除** - ×ボタンでアイテムが削除される
5. [ ] **買い物リスト：並び替え** - 「新しい順」「カテゴリ順」の切替が動作する
6. [ ] **在庫リスト：追加** - ＋ボタンで品名・カテゴリ・残量を指定して追加される
7. [ ] **在庫リスト：ステータス切替** - 十分/少ない/なし ボタンで残量が即時切り替わる
8. [ ] **在庫リスト：買い物へ追加** - 少ない/なしのアイテムに「買い物へ」ボタンが表示され、タップで買い物リストに追加される
9. [ ] **在庫リスト：編集** - 編集ボタンで品名・カテゴリ・残量・メモを変更できる
10. [ ] **在庫リスト：削除** - ×ボタンでアイテムが削除される
11. [ ] **検索** - 品名で絞り込みができる（両タブ共通）
12. [ ] **カテゴリフィルタ** - カテゴリチップをタップで絞り込みができる
13. [ ] **在庫ステータスフィルタ** - 十分/少ない/なし で絞り込みができる
14. [ ] **カテゴリ追加** - 設定画面で新しいカテゴリを追加でき、選択肢に反映される
15. [ ] **カテゴリ削除** - ユーザー追加カテゴリを削除できる（初期カテゴリは削除不可）
16. [ ] **表示名設定** - 設定で表示名を入力するとヘッダーに反映される
17. [ ] **共有（AirDrop）** - 共有ボタン→「共有する」でiOSの共有シートが開く
18. [ ] **フォールバック：コピー** - 「JSONをコピー」でクリップボードにコピーされる
19. [ ] **フォールバック：ダウンロード** - 「JSONファイルをダウンロード」でファイルが保存される
20. [ ] **インポート** - JSONファイルを選択すると確認画面が表示され、上書きインポートが実行される
21. [ ] **インポート：自動バックアップ** - インポート後に設定画面のバックアップ一覧に新しいバックアップが追加される
22. [ ] **バックアップ復元** - 設定画面でバックアップを選択し復元できる
23. [ ] **PWA** - ホーム画面に追加後、オフラインでもアプリが起動できる
24. [ ] **不正JSONの拒否** - 壊れたJSON / 必須キーのないJSONをインポートするとエラーが表示される
